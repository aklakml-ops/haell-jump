<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hael Jump Jump</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #222;
  overflow: hidden;
  height: 100%;
}

/* CANVAS FULL LAYAR */
canvas {
  display: block;
  margin: auto;
  width: 100vw;
  height: 100vh;
  max-width: 400px;
  max-height: 600px;
  background: #cceeff;
  touch-action: none;
}

/* KONTROL */
#kontrol {
  position: fixed;
  bottom: 20px;
  width: 100%;
  display: flex;
  justify-content: space-around;
  pointer-events: none;
}

.btn {
  width: 80px;
  height: 80px;
  background: rgba(0,0,0,0.35);
  border-radius: 50%;
  pointer-events: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2em;
  color: white;
  user-select: none;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="kontrol">
  <div class="btn" id="kiri">◀</div>
  <div class="btn" id="kanan">▶</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== CANVAS FIX 400x600 (TAJEM) ===== */
const LOGIC_WIDTH = 400;
const LOGIC_HEIGHT = 600;
const dpr = window.devicePixelRatio || 1;

canvas.width = LOGIC_WIDTH * dpr;
canvas.height = LOGIC_HEIGHT * dpr;
ctx.scale(dpr, dpr);

/* ===== PLAYER ===== */
let player = {
  x: 185,
  y: 300,
  w: 30,
  h: 30,
  vy: 0,
  speed: 4
};

const gravity = 0.4;
const jumpPower = -18;

/* ===== INPUT ===== */
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

let sentuh = { kiri:false, kanan:false };
kiri.ontouchstart = e => { sentuh.kiri = true; e.preventDefault(); };
kiri.ontouchend   = e => { sentuh.kiri = false; e.preventDefault(); };
kanan.ontouchstart = e => { sentuh.kanan = true; e.preventDefault(); };
kanan.ontouchend   = e => { sentuh.kanan = false; e.preventDefault(); };

/* ===== PLATFORM ===== */
let platforms = [];

function buatPlatform() {
  platforms = [];
  platforms.push({ x: 160, y: 350, w: 80, h: 10 });

  let y = 350;
  for (let i = 0; i < 6; i++) {
    y -= 80;
    platforms.push({
      x: Math.random() * 320,
      y,
      w: 80,
      h: 10
    });
  }
}

/* ===== SCORE ===== */
let skor = 0;
let skorMax = 0;
let gameOver = false;

function resetGame() {
  player.x = 185;
  player.y = 300;
  player.vy = 0;
  skor = 0;
  gameOver = false;
  buatPlatform();
}

buatPlatform();

/* ===== GAME LOOP ===== */
function update() {
  ctx.clearRect(0,0,LOGIC_WIDTH,LOGIC_HEIGHT);

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.8)";
    ctx.fillRect(0,0,LOGIC_WIDTH,LOGIC_HEIGHT);
    ctx.fillStyle = "white";
    ctx.font = "28px Arial";
    ctx.textAlign = "center";
    ctx.fillText("GAME OVER", 200, 250);
    ctx.fillText("Skor: " + skor, 200, 290);
    ctx.fillText("Tertinggi: " + skorMax, 200, 330);
    ctx.fillText("Tap untuk restart", 200, 380);
    requestAnimationFrame(update);
    return;
  }

  /* GERAK */
  if (keys["ArrowLeft"] || keys["a"] || sentuh.kiri) player.x -= player.speed;
  if (keys["ArrowRight"] || keys["d"] || sentuh.kanan) player.x += player.speed;

  if (player.x > LOGIC_WIDTH) player.x = -player.w;
  if (player.x < -player.w) player.x = LOGIC_WIDTH;

  /* GRAVITASI */
  player.vy += gravity;
  player.y += player.vy;

  /* TABRAKAN PLATFORM */
  platforms.forEach(p => {
    if (
      player.x < p.x + p.w &&
      player.x + player.w > p.x &&
      player.y + player.h <= p.y + 10 &&
      player.y + player.h + player.vy >= p.y
    ) {
      player.vy = jumpPower;
    }
  });

  /* KAMERA */
  if (player.y < 200) {
    let diff = 200 - player.y;
    player.y = 200;
    platforms.forEach(p => {
      p.y += diff;
      if (p.y > LOGIC_HEIGHT) {
        p.y = -80;
        p.x = Math.random() * 320;
      }
    });
    skor += Math.floor(diff);
  }

  if (player.y > LOGIC_HEIGHT) {
    gameOver = true;
    skorMax = Math.max(skor, skorMax);
  }

  /* DRAW */
  ctx.fillStyle = "red";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  ctx.fillStyle = "green";
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

  ctx.fillStyle = "black";
  ctx.font = "18px Arial";
  ctx.textAlign = "left";
  ctx.fillText("Skor: " + skor, 10, 25);
  ctx.fillText("High: " + skorMax, 10, 50);

  requestAnimationFrame(update);
}

canvas.addEventListener("touchstart", () => {
  if (gameOver) resetGame();
});

update();
</script>

</body>
</html>
